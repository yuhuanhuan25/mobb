!function(t){function e(t,e,i){if(t.indexOf("?")!=-1){var s=new RegExp("(\\?|&"+e+")=[^&]*");t=s.test(t)?t.replace(s,"$1="+i):t+"&"+e+"="+i}else t=t+"?"+e+"="+i;return t}function i(t,i){for(var s in i)t=e(t,encodeURIComponent(s),encodeURIComponent(i[s]));return t}function s(t){return o||(o=this.init(t))}function r(t){t.src="about:blank",t.parentNode&&t.parentNode.removeChild(t),t.onload=null}function n(t,e){return t=parseInt(t,10),e=parseInt(e,10),1!=t&&2!=t||1!=e?1!=t&&2!=t||4!=e?1!=t&&2!=t||7!=e?1!=t&&2!=t||8!=e?1!=t&&2!=t||9!=e?b["char"]:b.slidePuzzle:b.slide:b.coordinate:b.piece:b.click}var o,h=!!window.ActiveXObject,c=h&&8==document.documentMode,a={preTrigerPoint:"preTrigerPoint",securityCode:"securityCode"},p=function(t,e){return t.currentStyle?t.currentStyle[e]:document.defaultView.getComputedStyle(t,!1)[e]},d=function(t){return function(e){return Object.prototype.toString.call(e)=="[object "+t+"]"}},u=d("Object"),l=d("Function"),f=function(t,e){if(t&&e){if(u(e)){for(var i in e)t.style[i]=e[i];return e}return p(t,e)}},g=function(t){if("undefined"!=typeof t.offsetParent){for(var e=0,i=0;t;t=t.offsetParent){var s=p(t,"borderLeftWidth");s=s&&s.indexOf("px")>-1?parseInt(s,10):0;var r=p(t,"borderTopWidth");r=r&&r.indexOf("px")>-1?parseInt(r,10):0,c&&(s=r=0),e+=t.offsetLeft+s,i+=t.offsetTop+r}return[e,i]}return[t.x,t.y]},m=function(t){var e=f(t,"width"),i=f(t,"height");return[parseInt(e,10),parseInt(i,10)]},y=function(t,e,i){i=i||!1;var s={};for(var r in e)t[r]=e[r];if(i){for(var r in t)s[r]=t[r];return s}return t},w=function(t){var e=window.document.getElementsByTagName("script")[0],s=window.document.createElement("script"),r=t.callback||"callback",n="_aq_"+Math.floor(1e6*Math.random()),o=window[n]=t.success||function(){},h=t.url,c={};c[r]=n,t.data&&(c=y(c,t.data)),h=i(h,c),s.async=t.async||!0,s.src=h,s.onload=function(){s&&e.parentNode&&e.parentNode.removeChild(s),o=null},e.parentNode.insertBefore(s,e)},b={"char":{btn_width:298,height:152,width:300},click:{btn_width:326,height:483,width:328},coordinate:{btn_width:298,width:300,height:277},piece:{height:516,btn_width:362,width:366},slide:{height:260,width:300,btn_width:298},slidePuzzle:{height:232,width:300,btn_width:298},"default":{btn_width:350}},C={minHeight:40,minWidth:230},v={height:40,width:300},S={height:300,width:400},P={type:"point",ele:document.body,src:"",uin:"",capcd:"",lang:"2052",fb:1,startFn:function(){},endFn:function(){}},_={ERR_CODE_SUC:0,ERR_CODE_BACK:1,ERR_CODE_CLOSE:2};s.prototype={init:function(t){return this.opts=y(P,t||{}),this.initOptions(),this.listenFunc=[],this.readyFunc=[],this.msg=new TCapMsg("parent"),this.initListener(),this.create(),this.sess="",this},initOptions:function(){this.ele=this.opts.ele,this.src=this.opts.src,this.ticket="",this.randstr="",this.sizeSC=y({},S),this.securityIframe="",this.opts.firstvrytype&&2==this.opts.firstvrytype&&(this.src=this.opts.slide_src)},create:function(){var t=this;switch(this.opts.type){case"point":t.createPreTrigerPoint();break;case"embed":w({url:i(t.opts.s_type,{uid:this.opts.uin,cap_cd:this.opts.capcd,lang:this.opts.lang}),success:function(e){var s=n(e.capclass,e.subcapclass);t.sess=e.sess;var r=t.opts.domain+"/"+e.src_1+t.opts.s_type_suffix+"&sess="+e.sess+"&theme="+t.opts.theme;r=i(r,{noBorder:"noborder",fb:t.opts.fb}),t.createSecurityCode(r,s,t.opts.ele)}});break;case"popup":w({url:i(t.opts.s_type,{uid:this.opts.uin,cap_cd:this.opts.capcd,lang:this.opts.lang}),success:function(e){var s=n(e.capclass,e.subcapclass),r=t.opts.domain+"/"+e.src_1+t.opts.s_type_suffix+"&sess="+e.sess+"&theme="+t.opts.theme;r=i(r,{showtype:"popup",fb:t.opts.fb}),t.createSecurityCode(r,{width:s.width,height:s.height+40},document.body)}})}},createPreTrigerPoint:function(){this.wrap="",this.preTrigerPoint&&this.nullIframe(!0);var t=document.createElement("div"),e=document.createElement("iframe");e.setAttribute("frameborder","0",0),e.setAttribute("border","0"),e.marginheight=0,e.marginwidth=0,e.setAttribute("marginheight","0",0),e.setAttribute("marginwidth","0",0),e.scrolling="no";var s=p(this.ele,"width"),r=p(this.ele,"height");s&&"auto"!=s?parseInt(s,10)<C.minWidth?this.clientW=C.minWidth+"px":this.clientW=s:this.clientW="100%",!r||"auto"==r||parseInt(r,10)<C.minHeight?this.clientH=C.minHeight+"px":this.clientH=r;var n={width:this.clientW,height:this.clientH,border:"none",position:"relative",minHeight:C.minHeight+"px",minWidth:C.minWidth+"px",zIndex:10};if(this.opts.firstvrytype&&2==this.opts.firstvrytype&&(this.clientW=v.width+"px",this.clientH=v.height+"px",n={width:this.clientW,height:this.clientH,border:"none",position:"relative",minHeight:this.clientH,minWidth:this.clientW,zIndex:10}),f(e,n),this.src){this.opts.themeColor&&(this.src=i(this.src,{color:this.opts.themeColor}));var o=0;this.clientH.length>2&&(o=this.clientH.substr(0,this.clientH.length-2)),this.src=i(this.src,{uid:this.opts.uin,cap_cd:this.opts.capcd,height:o,lang:this.opts.lang,fb:this.opts.fb,theme:this.opts.theme,rnd:Math.floor(1e6*Math.random())}),e.src=this.src}this.preTrigerPoint=e,this.wrap=t,this.wrap.appendChild(this.preTrigerPoint),this.ele.appendChild(this.wrap),this.initPreTriggerPointTarget()},initListener:function(){var t=this;this.listenResize(),this.msg.listen(function(e){try{var s=JSON.parse(e)}catch(r){return}s=s.message;var o=s.type;switch(o){case 0:return void t.collapsePreTriggerPoint();case 1:return void(s.size&&t.setSCheight(parseInt(s.size.height,10)));case 2:return void t.send2preTriggerPoint();case 3:if(t.opts.startFn(),s&&s.ticket){t.ticket=s.ticket,t.randstr=s.randstr;for(var h=0,c=t.listenFunc.length;h<c;h++)"embed"==t.opts.type&&t.opts.keepOpen?(t.listenFunc[h]({ret:0,ticket:s.ticket,randstr:s.randstr}),t.opts.endFn()):t.closeSecurityCode(function(){t.listenFunc[h]({ret:0,ticket:s.ticket,randstr:s.randstr})});t.listenFunc.length||("embed"==t.opts.type&&t.opts.keepOpen?t.opts.endFn():t.closeSecurityCode());var a=parseInt(t.clientW,10)>C.minWidth?parseInt(t.clientW,10):C.minWidth;t.send2preTriggerPoint(JSON.stringify({message:{width:a-2,type:"reduce"}}))}else{if(s&&s.src){var p=n(s.captype,s.subcaptype);t.createSecurityCode(s.src,p,document.body),f(t.preTrigerPoint,{width:p.btn_width+2+"px"}),t.send2preTriggerPoint(JSON.stringify({message:{width:p.btn_width,type:"expand"}}))}t.securityIframe&&t.setPosition(t.securityIframe)}return;case 4:return void t.send2securityCode(JSON.stringify({message:{type:s.task}}));case 5:return void t.send2preTriggerPoint(JSON.stringify({message:{type:s.task}}));case 6:if(t.listenFunc.length)for(var h=0,c=t.listenFunc.length;h<c;h++)t.closeSecurityCode(function(){t.listenFunc[h]({ret:_.ERR_CODE_CLOSE,ticket:"",randstr:""})});else t.closeSecurityCode();return;case 7:f(t.preTrigerPoint,{width:s.size.btn_width+2+"px"});var d={height:s.size.height+"px",width:s.size.width+"px"};return f(t.securityIframe,d),void t.setPosition(t.securityIframe);case 8:return t.sess=s.sess,void w({url:i(t.opts.s_type,{uid:t.opts.uin,cap_cd:t.opts.capcd,lang:t.opts.lang,sess:t.sess}),success:function(e){switch(t.opts.type){case"embed":var s=n(e.capclass,e.subcapclass);t.sess=e.sess;var r=t.opts.domain+"/"+e.src_1+t.opts.s_type_suffix+"&sess="+e.sess+"&theme="+t.opts.theme;r=i(r,{noBorder:"noborder",fb:t.opts.fb}),t.replaceSccurityCode(r,s);break;case"popup":var s=n(e.capclass,e.subcapclass);t.sess=e.sess;var r=t.opts.domain+"/"+e.src_1+t.opts.s_type_suffix+"&sess="+e.sess+"&theme="+t.opts.theme;r=i(r,{showtype:"popup",fb:t.opts.fb}),t.replaceSccurityCode(r,{width:s.width,height:s.height+40});break;case"point":var s=n(e.capclass,e.subcapclass),r=t.opts.domain+"/"+e.src_1+t.opts.s_type_suffix+"&sess="+e.sess+"&theme="+t.opts.theme+"&firstvrytype=1";t.replaceSccurityCode(r,s)}}});case 10:if(t.readyFunc)for(var h=0,c=t.readyFunc.length;h<c;h++)t.readyFunc[h]&&t.readyFunc[h]();return}})},initPreTriggerPointTarget:function(){this.msg.addTarget(this.preTrigerPoint.contentWindow,a.preTrigerPoint)},replaceSccurityCode:function(t,e){this.sizeSC.height=e&&e.height?e.height:this.sizeSC.height,this.sizeSC.width=e&&e.width?e.width:this.sizeSC.width;var s=this;this.opts.themeColor&&(t=i(t,{color:this.opts.themeColor})),this.opts.type&&(t=i(t,{showtype:this.opts.type})),t=i(t,{uid:this.opts.uin,cap_cd:this.opts.capcd,lang:this.opts.lang,fb:this.opts.fb,rnd:Math.floor(1e6*Math.random())}),this.securityIframe.src=t;var r={height:this.sizeSC.height+"px",width:this.sizeSC.width+"px"};f(this.securityIframe,r),this.setPosition(s.securityIframe)},createSecurityCode:function(t,e,s){this.sizeSC.height=e&&e.height?e.height:this.sizeSC.height,this.sizeSC.width=e&&e.width?e.width:this.sizeSC.width;var r=this;if(this.opts.themeColor&&(t=i(t,{color:this.opts.themeColor})),this.opts.type&&(t=i(t,{showtype:this.opts.type})),t=i(t,{uid:this.opts.uin,cap_cd:this.opts.capcd,lang:this.opts.lang,fb:this.opts.fb,rnd:Math.floor(1e6*Math.random())}),this.hasSecurityCode()){this.securityIframe.src=t;var n={height:this.sizeSC.height+"px",width:this.sizeSC.width+"px"};return f(this.securityIframe,n),void this.setPosition(r.securityIframe)}var o=document.createElement("iframe");o.setAttribute("frameborder","0",0),o.setAttribute("border","0"),o.marginheight=0,o.marginwidth=0,o.setAttribute("marginheight","0",0),o.setAttribute("marginwidth","0",0);var h="embed"==this.opts.type?"relative":"absolute";if("popup"==this.opts.type&&this.opts.pos&&this.opts.pos.length>0)for(var c=["absolute","fixed","static","relative"],a=0;a<c.length;a++)if(this.opts.pos===c[a]){h=this.opts.pos;break}var n={width:this.sizeSC.width+"px",height:this.sizeSC.height+"px",border:"0px",position:h,left:"0px",top:"0px",zIndex:2000000001};f(o,n),this.securityIframe=o,s.appendChild(o),o.src=t,this.setPosition(o),this.initSecurityCodeTarget()},hasSecurityCode:function(){var t=!!this.securityIframe&&this.securityIframe;return t},initSecurityCodeTarget:function(){this.msg.addTarget(this.securityIframe.contentWindow,a.securityCode)},destroy:function(){o&&(this.closeSecurityCode(),this.listenFunc=[],this.readyFunc=[],this.msg.clear(),this.clearContainer(),this.ele="",o="")},refresh:function(t){o&&(this.closeSecurityCode(),this.clearContainer(),this.initOptions(),t&&u(t)&&(t.uin&&(this.opts.uin=t.uin),t.capcd&&(this.opts.capcd=t.capcd)),this.create())},clearContainer:function(){"popup"!=this.opts.type&&this.ele&&(this.ele.innerHTML="")},setSrc:function(t){this.tpl.src=t},listen:function(t,e){this.listenFunc.push(t),this.readyFunc.push(e)},clear:function(){this.listenFunc.length=0,this.readyFunc.length=0},send2preTriggerPoint:function(t){if("point"==this.opts.type){var e=a.preTrigerPoint;this.msg.targets[e].send(t)}},send2securityCode:function(t){var e=a.securityCode;this.msg.targets[e].send(t)},setSCheight:function(t){f(this.securityIframe,{height:t+"px"}),this.sizeSC.height=t,this.setPosition(this.securityIframe)},getPTPpos:function(){return g(this.preTrigerPoint)},getSCsize:function(){return[this.sizeSC.width,this.sizeSC.height]},getPTPsize:function(){return m(this.preTrigerPoint)},setPosition:function(t){if("embed"!=this.opts.type){var e=0,i=0;if("popup"==this.opts.type){var s=this.getSCsize(),r=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,n=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;e=(n-s[1])/2,i=(r-s[0])/2}if("point"==this.opts.type){var o=this.getPTPpos(),h=this.getPTPsize();e=o[1]+h[1],i=o[0]}return f(t,{top:e+"px",left:i+"px"})}},closeSecurityCode:function(t){this.opts.endFn(),this.securityIframe&&this.nullIframe(),l(t)&&t(),window.CollectGarbage&&window.CollectGarbage()},listenResize:function(){var t=this;window.onresize=function(){t.securityIframe&&t.setPosition(t.securityIframe)}},getTicket:function(){return{ticket:this.ticket,randstr:this.randstr}},collapsePreTriggerPoint:function(){c||f(this.preTrigerPoint,{width:this.clientW})},start:function(t){this.opts.startFn=t},end:function(t){this.opts.endFn=t},nullIframe:function(t){return t?(r(this.preTrigerPoint),void(this.preTrigerPoint=null)):(r(this.securityIframe),void(this.securityIframe=null))}},t.AqSCode=s}(window);